<div class="min-h-screen bg-gray-50 flex flex-col items-center py-10">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">Novo Atendimento</h2>
  <div class="w-full max-w-xl bg-white rounded-lg shadow p-6">
    <form (ngSubmit)="registrar()" class="space-y-6">
      <div>
        <label for="paciente" class="block text-sm font-medium text-gray-700 mb-1">Pesquisar paciente</label>
        <input id="paciente" [(ngModel)]="filtroPaciente" name="filtroPaciente" placeholder="Digite o nome do paciente..." class="border rounded px-3 py-2 w-full disabled-input" (ngModelChange)="onFiltroPacienteChange()" />
        <div *ngIf="pacientesFiltrados.length > 0" class="mt-2">
          <div *ngFor="let paciente of pacientesFiltrados" class="border-b py-2 cursor-pointer hover:bg-blue-50" (click)="selecionarPaciente(paciente)">
            {{ paciente.nome }} <span class="text-xs text-gray-500">{{ paciente.nascimento | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
        <div *ngIf="filtroPaciente && pacientesFiltrados.length === 0 && !pacienteSelecionado" class="mt-2 text-sm text-red-600">
          Nenhum paciente encontrado.<br>
          <span class="block mt-1">Cadastre um novo paciente para continuar.</span>
          <button type="button" (click)="abrirCadastroPaciente()" class="text-blue-600 underline mt-2">Cadastrar novo paciente</button>
        </div>
      </div>
      <div *ngIf="pacienteSelecionado">
        <label class="block text-sm font-medium text-gray-700 mb-1">Paciente selecionado</label>
        <div class="p-3 bg-gray-100 rounded mb-2">
          <strong>{{ pacienteSelecionado.nome }}</strong><br>
          <span class="text-xs text-gray-500">{{ pacienteSelecionado.nascimento | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>
      <div>
        <label for="motivo" class="block text-sm font-medium text-gray-700 mb-1">Motivo do atendimento</label>
        <input id="motivo" [(ngModel)]="motivo" name="motivo" required class="border rounded px-3 py-2 w-full disabled-input" [disabled]="!pacienteSelecionado" />
      </div>
      <div>
        <label for="observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observações</label>
        <textarea id="observacoes" [(ngModel)]="observacoes" name="observacoes" class="border rounded px-3 py-2 w-full disabled-input" [disabled]="!pacienteSelecionado"></textarea>
<style>
  .disabled-input:disabled {
    background: #f3f3f3 !important;
    color: #bdbdbd !important;
    border-color: #e0e0e0 !important;
    cursor: not-allowed;
    opacity: 1;
  }
</style>
      </div>
      <button type="submit" class="w-full py-2 px-4 bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 transition" [disabled]="!pacienteSelecionado">Registrar Atendimento</button>
      <div *ngIf="mensagem" class="text-sm text-green-700 mt-2">{{ mensagem }}</div>
    </form>
  </div>
  <app-pacientes-form *ngIf="exibirCadastroPaciente" (fechar)="fecharCadastroPaciente()"></app-pacientes-form>
</div>
