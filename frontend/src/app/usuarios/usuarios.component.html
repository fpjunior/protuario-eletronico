<div class="max-w-2xl mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4">Usuários</h2>

  <form [formGroup]="usuarioForm" (ngSubmit)="cadastrarUsuario()" class="mb-8 bg-white rounded shadow p-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block font-medium">Nome <span class="text-red-500">*</span></label>
        <input formControlName="nome" class="input input-bordered w-full" [class.border-red-500]="usuarioForm.get('nome')?.invalid && usuarioForm.get('nome')?.touched" />
        <div *ngIf="usuarioForm.get('nome')?.invalid && usuarioForm.get('nome')?.touched" class="text-xs text-red-500">Nome é obrigatório</div>
      </div>
      <div>
        <label class="block font-medium">Email <span class="text-red-500">*</span></label>
        <input formControlName="email" class="input input-bordered w-full" [class.border-red-500]="usuarioForm.get('email')?.invalid && usuarioForm.get('email')?.touched" />
        <div *ngIf="usuarioForm.get('email')?.invalid && usuarioForm.get('email')?.touched" class="text-xs text-red-500">Email válido é obrigatório</div>
      </div>
      <div>
        <label class="block font-medium">Senha <span class="text-red-500">*</span></label>
        <input type="password" formControlName="senha" class="input input-bordered w-full" [class.border-red-500]="usuarioForm.get('senha')?.invalid && usuarioForm.get('senha')?.touched" />
        <div *ngIf="usuarioForm.get('senha')?.invalid && usuarioForm.get('senha')?.touched" class="text-xs text-red-500">Senha é obrigatória</div>
      </div>
      <div>
        <label class="block font-medium">Nível de acesso <span class="text-red-500">*</span></label>
        <select formControlName="nivel" class="input input-bordered w-full">
          <option *ngFor="let n of niveis" [value]="n.value">{{ n.label }}</option>
        </select>
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-4 w-full md:w-auto" [disabled]="usuarioForm.invalid || loading || isVisualizador">
      <span *ngIf="!loading">Cadastrar usuário</span>
      <span *ngIf="loading">Cadastrando...</span>
    </button>
    <div *ngIf="isVisualizador" class="text-red-600 mt-2">Usuário não autorizado para editar ou cadastrar um usuário.</div>
    <div *ngIf="success" class="text-green-600 mt-2">{{ success }}</div>
    <div *ngIf="error" class="text-red-600 mt-2">{{ error }}</div>
  </form>

  <div *ngIf="loading && !usuarios.length" class="text-center">Carregando...</div>
  <table *ngIf="usuarios.length" class="min-w-full bg-white rounded shadow">
    <thead>
      <tr>
        <th class="py-2 px-4">Nome</th>
        <th class="py-2 px-4">Email</th>
        <th class="py-2 px-4">Nível</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of usuarios">
        <td class="py-2 px-4">{{ u.nome }}</td>
        <td class="py-2 px-4">{{ u.email }}</td>
        <td class="py-2 px-4">{{ u.nivel }}</td>
      </tr>
    </tbody>
  </table>
</div>
