<div class="ficha-container" [ngClass]="{edicao: pacienteEditando}">
  <h1>Prontuário Eletrônico</h1>
  <form [formGroup]="form" (ngSubmit)="salvar()" class="paciente-form" autocomplete="off">
    <mat-form-field appearance="fill">
      <mat-label>Nome</mat-label>
      <input matInput formControlName="nome" />
      <mat-error *ngIf="form.get('nome')?.invalid && (form.get('nome')?.dirty || form.get('nome')?.touched)">Nome é obrigatório.</mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Nome da mãe</mat-label>
      <input matInput formControlName="mae" />
      <mat-error *ngIf="form.get('mae')?.invalid && (form.get('mae')?.dirty || form.get('mae')?.touched)">Nome da mãe é obrigatório.</mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Data de Nascimento</mat-label>
      <input matInput formControlName="nascimento" type="date" />
      <mat-error *ngIf="form.get('nascimento')?.invalid && (form.get('nascimento')?.dirty || form.get('nascimento')?.touched)">Data de nascimento é obrigatória.</mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Sexo</mat-label>
      <mat-select formControlName="sexo">
        <mat-option value="M">Masculino</mat-option>
        <mat-option value="F">Feminino</mat-option>
        <mat-option value="I">Ignorado</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('sexo')?.invalid && (form.get('sexo')?.dirty || form.get('sexo')?.touched)">Sexo é obrigatório.</mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Estado Civil</mat-label>
      <mat-select formControlName="estadoCivil">
        <mat-option value="Solteiro(a)">Solteiro(a)</mat-option>
        <mat-option value="Casado(a)">Casado(a)</mat-option>
        <mat-option value="Viúvo(a)">Viúvo(a)</mat-option>
        <mat-option value="Divorciado(a)">Divorciado(a)</mat-option>
        <mat-option value="Ignorado">Ignorado</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Profissão</mat-label>
      <input matInput formControlName="profissao" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Escolaridade</mat-label>
      <input matInput formControlName="escolaridade" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Raça/Cor</mat-label>
      <mat-select formControlName="raca">
        <mat-option value="Branca">Branca</mat-option>
        <mat-option value="Preta">Preta</mat-option>
        <mat-option value="Parda">Parda</mat-option>
        <mat-option value="Amarela">Amarela</mat-option>
        <mat-option value="Indígena">Indígena</mat-option>
        <mat-option value="Ignorado">Ignorado</mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Endereço</mat-label>
      <input matInput formControlName="endereco" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Bairro</mat-label>
      <input matInput formControlName="bairro" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Município</mat-label>
      <input matInput formControlName="municipio" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>UF</mat-label>
      <input matInput formControlName="uf" maxlength="2" />
      <mat-error *ngIf="form.get('uf')?.invalid && (form.get('uf')?.dirty || form.get('uf')?.touched)">UF deve ter 2 letras.</mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>CEP</mat-label>
      <input matInput formControlName="cep" maxlength="9" />
      <mat-error *ngIf="form.get('cep')?.invalid && (form.get('cep')?.dirty || form.get('cep')?.touched)">CEP inválido. Ex: 12345-678</mat-error>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Acompanhante</mat-label>
      <input matInput formControlName="acompanhante" />
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Procedência</mat-label>
      <input matInput formControlName="procedencia" />
    </mat-form-field>
    <mat-error *ngIf="form.errors?.['nomeNascimentoDuplicado']">Já existe paciente com este nome e data de nascimento.</mat-error>
    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid || form.pending">
      {{ pacienteEditando ? 'Atualizar' : 'Salvar' }}
    </button>
    <button mat-raised-button type="button" class="cancelar-btn" (click)="cancelar()">
      Cancelar
    </button>
  </form>
</div>
